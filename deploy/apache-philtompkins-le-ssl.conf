<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName philtompkins.com
    ServerAdmin support@weevolveus.com

    # Proxy to Next.js app
    ProxyPreserveHost On
    ProxyPass / http://localhost:3002/
    ProxyPassReverse / http://localhost:3002/

    # WebSocket support (for HMR in dev, not needed in prod but doesn't hurt)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule /(.*) ws://localhost:3002/$1 [P,L]

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set X-XSS-Protection "1; mode=block"

    # Cache static assets
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </LocationMatch>

    # Gzip
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/css application/json application/javascript text/xml application/xml
    </IfModule>

    ErrorLog ${APACHE_LOG_DIR}/philtompkins_error.log
    CustomLog ${APACHE_LOG_DIR}/philtompkins_access.log combined

    SSLCertificateFile /etc/letsencrypt/live/philtompkins.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/philtompkins.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
